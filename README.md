# social_network_system_design
ДЗ курса по [System Design](https://balun.courses/courses/system_design)
# Социальная сеть для путешественников "Travel shots"
_Специальная социальная сеть для путешественников
Будущая аудитория социальной сети - у бизнеса есть огромные средства для рекламы и продвижения социальной
сети, поэтому пользовательская база будет постепенно линейно расти и через год достигнет примерно 10 000 000 уникальных
пользователей в день, после чего также будет продолжать расти. Бизнес пока нацелен  только на аудиторию стран СНГ
(на зарубежный рынок выходить планов нет). Будущая система должна быть очень надежной, а также, чтобы с ней было удобно
взаимодействовать, используя мобильные устройства и браузер._

## Функциональные требования

- публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;
- оценка и комментарии постов других путешественников;
- подписка на других путешественников, чтобы следить за их активностью;
- поиск популярных мест для путешествий и просмотр постов с этих мест в виде ТОПа мест по странам и городам;
- общение с другими путешественниками в личных сообщениях;
- просмотр ленты других путешественников;
- взаимодействие с сетью, используя мобильные устройства и браузер.

## Нефункциональные требования

- **Аудитория приложения**
    - Количество пользователей
      > - Какое количество пользователей (DAU / MAU) ожидается в будущем приложении, а также, как оно будет расти?
        - 10 000 000 DAU
        - 65 000 000 MAU (Население СНГ ~240млн. человек)
      
    - Поведение пользователей

      > - Сколько один пользователь в день будет, в среднем, создавать запросов к будущему приложению?
        - Один пользователь, в среднем, будет делать 8 запросов в день к приложению:
          - 3 Просмотр ленты постов 
          - 1 Просмотр комментариев 
          - 3 Просмотр сообщений (синхронизация)
          - 0,6 Отправка сообщений
          - 0,3 Отправка комментария
          - 0,1 Отправка поста
      >
    - Регионы использования приложения

      > - На аудиторию каких регионов/стран будет запущено будущее приложение?
        - Только на СНГ.
      >
- **Особенности приложения**
    - Сезонности в приложении

      > - Будут ли сезонности, когда приложением в определенный период будут использовать большое количество пользователей?
        - Да, природная сезонность, а также государственные и религиозные календари. 
        Считаем от средней нагрузки за год: 
          - +15% в период школьных каникул, 
          - +50% Новогодние, майские праздники, 
          - +25% периоды цветения 
          - +15% религиозные праздники, время паломничества.
      >
    - Условия хранения данных

      > - Данные храним всегда, либо можно удалять/агрегировать какие-либо данные спустя какое-либо время?
        - Храним всегда.
      >
    - Лимиты и ограничения

      > - Если делаем подписки, то какое максимальное количество подписчиков может быть у пользователя?
        - 10 000 000 подписчиков.
      > - Частота ошибок: 
        - Менее 0,4% запросов должны приводить к ошибкам. 0,05% - по доступности приложения. 0,35% - запланированные ошибки, например,  не более 100 постов в день. ограничения по размеру фото.. Система при наличии ограничений должна сама убирать возможность отправки (неативная кнопка до истечения блокировки), дабы не вынуждать пользователя делать ошибочный запрос и получать ошибку в ответ. Также и с ограничением по размеру файла - вместо попытки загрузки на сервер можно вывести предупреждение.
          В общем итоге это улучшает пользовательский опыт и снижает нагрузку на сервер.

    - Временные ограничения

      > - Время отклика? 
       - Запросы на чтение должны быть выполнены в течение 150 мс
       - Запросы на запись должны быть выполнены в течение 800 мс

      > - Доступность приложения. Сколько по времени приложение может быть недоступно за год?
        - Не более, чем несколько часов простоя в год. ~99,95%
  
    - Безопасность
      > - Защита (Шифрование) пользовательских данных от несанкционированного доступа.
      > - Безопасные методы аутентификации пользователя
    
    - Масштабируемость
      > - Поддержка горизонтального масштабирования и способность выдерживать нагрузку при влиянии сезонности.  

## Оценка нагрузки
- **Расчет RPS = dau * avg_requests_per_day_by_user / 86 400**
    
  > - RPS = 10 000 000 * 8 / 86 400 = 926
  > - Просмотр ленты постов - 3.   RPS = 10_000_000 * 3 / 86_400 = 347
  > - Просмотр комментариев - 1.   RPS = 10_000_000 * 1 / 86_400 = 115
  > - Просмотр сообщений (синхронизация) - 3. RPS = 10_000_000 * 3 / 86_400 = 347
  > - Отправка сообщений - 0,6.    RPS = 10_000_000 * 0,6 / 86_400 = 69,4
  > - Отправка комментария - 0,3.  RPS = 10_000_000 * 0,3 / 86_400 = 34,7
  > - Отправка поста - 0,1.        RPS = 10_000_000 * 0,1 / 86_400 = 11,5

      
- **Расчет Traffic = rps * avg_request_size**
  > - средний размер запроса будет составлять 62 КБ
  >   - Traffic = 926 * 62КБ = 58029 КБ/с
  > - Просмотр ленты постов 
  >   - RPS = 347    
  >   - Traffic = 347 * 100 = 34700 кб/с
  > - Просмотр комментариев 
  >   - RPS = 115    
  >   - Traffic = 115 * 20 = 2300 кб/с
  > - Просмотр сообщений    
  >   - RPS = 347    
  >   - Traffic = 347 * 50 = 17350 кб/с 
  > - Отправка сообщений    
  >   - RPS = 69,4   
  >   - Traffic = 69,4 * 30 = 2082 кб/с 
  > - Отправка комментария  
  >   - RPS= 34,7    
  >   - Traffic = 34,7 * 10 = 347 кб/с 
  > - Отправка поста        
  >   -   RPS = 11,5   
  >   - Traffic = 11,5 * 100 = 1150 кб/с

- **Расчет одновременных соединений = dau * 0.1**
  > - Connections = 10 000 000 * 0.1 = 1 000 000

- **Оценка дисков для хранения и обработки данных**
  > - Disks_for_capacity = capacity / disk_capacity
  > - Disks_for_throughput = traffic_per_second / disk_throughput
  > - Disks_for_iops = iops / disk_iops
  > - Disks = max(ceil(Disks_for_capacity), ceil(Disks_for_throughput), ceil(Disks_for_iops))
  
  > - Сapacity = 3.6 МБ/с * 86 400 * 365 = 113 ТБ
  > - Disks_for_capacity = 113 ТБ / 15 ТБ = 7.5 (Samsung PM9A3)
  > - Disks_for_throughput = 58 МБ/с / 500 МБ/с = 0.116
  > - Disks_for_iops = 926 / 1000 = 0.93
  > - Disks = max(ceil(7.5), ceil(0.116), ceil(0.93)) = 8
  > - Где:
  >  - capacity - суммарный объем данных, которое необходимо хранить
  >  - disk_capacity - объем одного диска
  >  - traffic_per_second - суммарный трафик на запись/чтение в секунду
  >  - disk_throughput - пропускная способность одного диска
  >  - iops - суммарное количество запросов в секунду
  >  - disk_iops - количество операций ввода-вывод диска в секунду
  >  - ceil - функция округления вверх до целого числа
  >  - 86 400 - 24 часа * 60 минут * 60 секунд
  >  - 365 - количество дней в году
  >  - 500 МБ/с - средняя пропускная способность SSD диска
  >  - 1000 - IOPS SSD диска
  
- **Расчет приблизительного количества хостов для хранения и обработки данных**
  > - Hosts = disks / disks_per_host
  >   - Hosts = 8 / 8 = 1    (s3 для хранения фото)
  > - Hosts_with_replication = hosts * replication_factor
  >   - Hosts_with_replication = 1 * 2 = 2